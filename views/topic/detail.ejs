<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title><%= title %></title>
<meta name="description" content="{{= d.description }}">

<%- include("../link.ejs") %>
<script  src="/javascripts/time_conversion.js"></script>
</head>
<body>

<%- include("../header.ejs") %>
<% if(post.length!=0){ %>
<div class="main layui-clear">
  <div class="wrap">
    <div class="content detail">
      <h1><%= post[0].get('title') %></h1>
      <div class="fly-tip fly-detail-hint" data-id="{{rows.id}}">
        <% if( post[0].get('recommend')==1 ){ %>
          <span class="fly-tip-jie">已采纳</span>
        <% }else { %>
        <span>未结贴</span>
        <% } %>

        <% if( post[0].get('questionerId')==currentUser.get('id') ){ %>
        <span class="jie-admin" type="del" style="margin-left: 20px;">删除</span>
        <% } %>

            <!-- <span class="jie-admin" type="set" field="stick" rank="0" style="background-color:#ccc;">取消置顶</span>

            <span class="jie-admin" type="set" field="stick" rank="1">置顶</span>


            <span class="jie-admin" type="set" field="status" rank="0" style="background-color:#ccc;">取消加精</span>

            <span class="jie-admin" type="set" field="status" rank="1">加精</span> -->


        <div class="fly-list-hint">
          <i class="iconfont" title="回答">&#xe60c;</i> <%= post[0].get('consultations') %>
          <i class="iconfont" title="人气">&#xe60b;</i> <%= post[0].get('visits') %>
        </div>
      </div>
      <div class="detail-about">
        <a class="jie-user" href="/users/home?uid=<%= post[0].get('questionerId') %>">
          <img src=<%= post[0].get('questionerAvatar') %> alt="<%= post[0].get('questionerNickName') %>">
          <cite>
            <%= post[0].get('questionerNickName') %>

            <em style="padding:0 5px; color: #FF7200;">VIP</em>

            <script>
              var time = getDateDiff(<%= post[0].get('createdAt').getTime() %>);
              document.write("<em>" + time + "</em>");  // 输出语句
            </script>

          </cite>
        </a>
        <div class="detail-hits" data-id="{{rows.id}}">

          <span style="color:#FF7200">悬赏：<%= post[0].get('reward') %>博士点</span>

          <% if( post[0].get('questionerId')==currentUser.get('id') ){ %>
          <span class="jie-admin" type="edit"><a href="/topic/edit?pId=<%= post[0].get('id') %>">编辑此贴</a></span>
          <% }else{ %>
            <span class="jie-admin" type="collect"><a href="/topic/collect?pId=<%= post[0].get('id') %>">收藏</a></span>
            <% } %>
        </div>
      </div>

      <div class="detail-body photos" style="margin-bottom: 20px;">
        <%= post[0].get('content') %>
      </div>



      <a name="comment"></a>
      <h2 class="page-title">热忱回答<span><em id="jiedaCount">2</em></span></h2>

      <ul class="jieda photos" id="jieda">

        <!-- <li data-id="{{item.id}}" class="jieda-daan">
          <a name="item-{{item.time}}"></a>
          <div class="detail-about detail-about-reply">
            <a class="jie-user" href="/u/">
              <img src="#" alt="">
              <cite>
                <i>博士</i>

                <em style="padding:0 ; color: #FF7200;">VIP</em>

                {{# if(item.user.username === rows.username){ }}
                <em>(楼主)</em>
                {{# } else if(item.user.auth == 1) { }}
                <em style="color:#5FB878">(管理员)</em>
                {{# } else if(item.user.auth == 2) { }}
                <em style="color:#FF9E3F">（活雷锋）</em>
                {{# } else if(item.user.auth == -1) { }}
                <em style="color:#999">（该号已被封）</em>
                {{# } }}
              </cite>
            </a>
            <div class="detail-hits">
              <span>一天前</span>
            </div>

            <i class="iconfont icon-caina" title="最佳答案"></i>

          </div>
          <div class="detail-body jieda-body">
            1234
          </div>
          <div class="jieda-reply">
          <span class="jieda-zan {{d.session['zan'+item.id] ? 'zanok' : ''}}" type="zan">
            <i class="iconfont icon-zan"></i>
            <em>{{item.praise}}</em>
          </span>
          <span type="reply">
            <i class="iconfont icon-svgmoban53"></i>
            回复
          </span>
          {{# if(user.auth == 1 || user.auth == 2 || (user.username && myself && !myda)){ }}
            <div class="jieda-admin">
            {{# if(user.auth == 1 || (user.auth == 2 && item.accept != 1)){ }}
              <span type="edit">
                编辑
              </span>
              <span type="del">
                删除
              </span>
              {{# if(rows.accept == -1){ }}
              <span class="jieda-accept" type="accept">
                采纳
              </span>
              {{# } }}
            {{# } else if(rows.accept == -1 && !myda){ }}
              <span class="jieda-accept" type="accept">
                采纳
              </span>
            {{# } }}
            </div>
          {{# } }}
          </div>
        </li> -->
      <!-- {{# }); if(jieda.length === 0){ }}
        <li class="fly-none">没有任何回答</li>
      {{# } }} -->
      </ul>

      <div class="layui-form layui-form-pane">
        <form action="/topic/reply/" method="post">
          <div class="layui-form-item layui-form-text">
            <div class="layui-input-block">
              <textarea id="content" name="content" required lay-verify="required" placeholder="我要<% if(post[0].get('questionerId')==currentUser.get('id')){ %>自问自答<% }else{ %>回答<% } %>"  class="layui-textarea fly-editor" style="height: 150px;"></textarea>
            </div>
          </div>
          <div class="layui-form-item">
            <input type="hidden" name="jid" value="{{rows.id}}">
            <button class="layui-btn" lay-filter="*" lay-submit>提交回答</button>
          </div>
        </form>
      </div>

    </div>
  </div>
  <div class="edge">

    <h3 class="page-title">最近热帖</h3>
    <ol class="fly-list-one">
    {{# d.hot.forEach(function(item){ }}
      <li>
        <a href="/jie/{{item.id}}.html">{{= item.title }}</a>
        <span><i class="iconfont">&#xe60b;</i> {{item.hits}}</span>
      </li>
    {{# }); }}
    </ol>

    {{ include ../ad/edge }}

    <h3 class="page-title">近期热议</h3>
    <ol class="fly-list-one">
    {{# d.hotda.forEach(function(item){ }}
      <li>
        <a href="/jie/{{item.id}}.html">{{= item.title }}</a>
        <span><i class="iconfont">&#xe60c;</i> {{item.comment}}</span>
      </li>
    {{# }); }}
    </ol>

  </div>
</div>
<% } else { %>
<h2 class="page-title">404</h2>
<div class="fly-none">该问题并不存在，肯能已被删除</div>
<% } %>

<%- include("../footer.ejs") %>

</body>
</html>
